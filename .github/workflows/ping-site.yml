name: Keep backend site awake (ping every 15m)

on:
  schedule:
    # runs every 10 minutes (GitHub Actions uses UTC)
    - cron: "*/10 * * * *"
  # optional manual trigger
  workflow_dispatch:

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping website with retries
        run: |
          set -euo pipefail

          URL="https://qkart-backend-36n2.onrender.com"

          MAX_RETRIES=3
          RETRY_DELAY=5  # seconds between retries
          ATTEMPT=0

          while [ $ATTEMPT -lt $MAX_RETRIES ]; do
            ATTEMPT=$((ATTEMPT+1))
            echo "Attempt $ATTEMPT: GET $URL"
            # curl returns non-zero on HTTP >=400 or network failures with --fail
            if curl --fail --silent --show-error --max-time 120 "$URL" -o /dev/null; then
              echo "Success on attempt $ATTEMPT"
              exit 0
            else
              echo "Attempt $ATTEMPT failed."
              if [ $ATTEMPT -lt $MAX_RETRIES ]; then
                echo "Waiting ${RETRY_DELAY}s before retry..."
                sleep $RETRY_DELAY
              fi
            fi
          done

          echo "All $MAX_RETRIES attempts failed â€” exiting with error."
          exit 1
